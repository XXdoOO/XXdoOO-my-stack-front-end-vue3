import{d as ee,s as ne,r as N,E as O,o as oe,a as te,N as se,i as t,b as h,c as g,e as l,f as c,w as _,g as $,v as T,O as z,t as r,F as Q,G as K,j as w,u as le,P as ae,J as ie,Q as V,p as W,R as ce,_ as ue,S as de,q as re,y as m,k as x,T as X,I as pe,U as _e,V as ve,z as he,A as me,B as fe}from"./index.c5284cad.js";import{C as ke}from"./index.d2d9ab6f.js";const L=B=>(he("data-v-7102557e"),B=B(),me(),B),Ce={key:0,class:"container"},ge={class:"content"},we={class:"blog"},Ue={class:"ip"},ye={class:"comments"},De={class:"header"},$e={class:"area"},Be={class:"all-comment"},Ee={class:"detail"},Se={class:"top"},xe={class:"nickname"},Ie={class:"time"},be={class:"center"},Fe={class:"bottom"},Ne={class:"icons"},Te={class:"area"},ze={key:0,class:"children"},Ve={class:"comment"},Le={class:"detail"},Ae={class:"top"},Re={class:"nickname"},Me={key:1,class:"nickname"},Pe={class:"time"},je={class:"center"},qe={class:"bottom"},He={class:"icons"},Ge={class:"area"},Je={class:"sidebar"},Oe={class:"author-info"},Qe={class:"account"},Ke=L(()=>l("span",null,"\u53D1\u5E03",-1)),We=L(()=>l("span",null,"\u9876\u8FC7",-1)),Xe=L(()=>l("span",null,"\u8E29\u8FC7",-1)),Ye={class:"icon-bar"},Ze=ee({__name:"index",setup(B){const Y=le(),I=ne().userInfo,y=Y.params.blogId;let a=N(null),v=O([]),D=N(""),f=N("");const U=O({pageNum:1,pageSize:10,total:"0"}),Z=s=>{V({blogId:y,parent:s.id,pageNum:++s.pageNum,pageSize:3}).then(n=>{n.list.forEach(i=>{i.show=!1}),s.children.push(...n.list),s.total=n.total})},A=s=>{let n=!0;s.isShow&&(n=!1),v.forEach(i=>{var d;i.isShow=!1,(d=i.children)==null||d.forEach(u=>{u.isShow=!1})}),n&&(s.isShow=!0)},b=(s,n,i)=>{ae({blogId:y,parent:s,receiveId:n,content:i}).then(d=>{if(d.children=[],console.log(d),s){for(const u of v)if(u.id==s){u.children.push(d);break}}else v.unshift(d);v.forEach(u=>{var k;u.isShow=!1,(k=u.children)==null||k.forEach(C=>{C.isShow=!1})})})},R=s=>{ke(`\u786E\u8BA4\u5220\u9664\u8BC4\u8BBA\u201C${s.content}\u201D\u5417?`,()=>{_e(s.id).then(n=>{console.log(n);e:for(let i=0;i<v.length;i++){if(v[i].id==s.id){v.splice(i,1);break e}for(let d=0;d<v[i].children.length;d++)if(v[i].children[d].id==s.id){v[i].children.splice(d,1);break e}}})})},F=(s,n)=>{ie(s,n).then(i=>{console.log(i)})},E=(s,n)=>{ve(s,n).then(i=>{console.log(i)})},M=()=>{const s=document.documentElement;s.scrollHeight-s.scrollTop-s.clientHeight<1&&U.pageNum*U.pageSize<parseInt(U.total)&&(U.pageNum++,P())};oe(()=>{window.addEventListener("scroll",M)}),te(()=>{window.removeEventListener("scroll",M)});const P=()=>{V({blogId:y,...U}).then(s=>{U.total=s.total,s.list.forEach(i=>{i.isShow=!1});const n=[];s.list.forEach(i=>{n.push(V({blogId:y,parent:i.id,pageSize:3}))}),Promise.all(n).then(i=>{console.log(i),i.forEach((d,u)=>{d.list.forEach(k=>{k.isShow=!1}),s.list[u].children=d.list,s.list[u].total=d.total,s.list[u].pageNum=1}),v.push(...s.list),console.log(v)})})};return se(y).then(s=>{a.value=s,a.value.content=`# ${s.title}
## ${s.description}
${s.content}`}),P(),(s,n)=>{var j;const i=W("v-md-preview"),d=ce,u=ue,k=de,C=re,S=W("router-link");return t(a)?(h(),g("main",Ce,[l("div",ge,[l("div",we,[c(i,{text:t(a).content},null,8,["text"]),l("div",Ue,[c(d,null,{default:_(()=>[m(r(t(a).ipTerritory),1)]),_:1}),c(u,{icon:"history",type:"text"},{default:_(()=>[m(r(t(a).createTime),1)]),_:1})])]),l("div",ye,[l("div",De,[l("div",null,[c(k,{src:`/api${(j=t(I))==null?void 0:j.avatar}`},null,8,["src"])]),l("div",$e,[$(l("textarea",{class:"content","onUpdate:modelValue":n[0]||(n[0]=e=>z(D)?D.value=e:D=e),placeholder:"\u8BF4\u8BF4\u4F60\u7684\u770B\u6CD5"},null,512),[[T,t(D)]]),c(C,{class:"btn",onClick:n[1]||(n[1]=e=>b(void 0,void 0,t(D)))},{default:_(()=>[m("\u53D1\u5E03")]),_:1})])]),l("div",Be,"\u5168\u90E8\u8BC4\u8BBA\uFF1A"+r(t(a).comment)+"\u6761",1),(h(!0),g(Q,null,K(t(v),e=>{var q,H,G;return h(),g("div",{class:"comment",key:e.id},[c(k,{src:`/api${e.sender.avatar}`},null,8,["src"]),l("div",Ee,[l("div",Se,[l("div",xe,r(e.sender.nickname),1),l("div",Ie,r(e.createTime),1)]),l("p",be,r(e.content),1),l("div",Fe,[c(d,{size:"small"},{default:_(()=>[m(r(e.ipTerritory),1)]),_:2},1024),c(C,{type:"text",onClick:o=>A(e),style:{"margin-left":"15px"}},{default:_(()=>[m(r(e.isShow?"\u6536\u8D77":"\u56DE\u590D"),1)]),_:2},1032,["onClick"]),l("div",Ne,[e.sender.id==((q=t(I))==null?void 0:q.id)?(h(),x(u,{key:0,onClick:o=>R(e),icon:"delete"},null,8,["onClick"])):w("",!0),c(u,{onClick:o=>E(e.id,1),num:e.down,"onUpdate:num":o=>e.down=o,active:e.isDown,"onUpdate:active":o=>e.isDown=o,icon:"down-active"},null,8,["onClick","num","onUpdate:num","active","onUpdate:active"]),c(u,{onClick:o=>E(e.id,0),num:e.up,"onUpdate:num":o=>e.up=o,active:e.isUp,"onUpdate:active":o=>e.isUp=o,icon:"up-active"},null,8,["onClick","num","onUpdate:num","active","onUpdate:active"])])]),$(l("div",Te,[$(l("textarea",{class:"content","onUpdate:modelValue":n[2]||(n[2]=o=>z(f)?f.value=o:f=o),placeholder:"\u8BF4\u8BF4\u4F60\u7684\u770B\u6CD5"},null,512),[[T,t(f)]]),c(C,{class:"btn",onClick:o=>b(e.id,void 0,t(f))},{default:_(()=>[m("\u56DE\u590D")]),_:2},1032,["onClick"])],512),[[X,e.isShow]]),((H=e.children)==null?void 0:H.length)!=0?(h(),g("div",ze,[(h(!0),g(Q,null,K(e.children,o=>{var J;return h(),g("div",Ve,[c(k,{src:`/api${o.sender.avatar}`,size:"40px"},null,8,["src"]),l("div",Le,[l("div",Ae,[l("div",Re,r(o.sender.nickname),1),o.receiver?(h(),x(u,{key:0,class:"arrow",icon:"arrow-right",type:"text"})):w("",!0),o.receiver?(h(),g("div",Me,r(o.receiver.nickname),1)):w("",!0),l("div",Pe,r(o.createTime),1)]),l("p",je,r(o.content),1),l("div",qe,[c(d,{size:"small"},{default:_(()=>[m(r(o.ipTerritory),1)]),_:2},1024),c(C,{type:"text",onClick:p=>A(o),style:{"margin-left":"15px"}},{default:_(()=>[m(r(o.isShow?"\u6536\u8D77":"\u56DE\u590D"),1)]),_:2},1032,["onClick"]),l("div",He,[o.sender.id==((J=t(I))==null?void 0:J.id)?(h(),x(u,{key:0,onClick:p=>R(o),icon:"delete"},null,8,["onClick"])):w("",!0),c(u,{onClick:p=>E(o.id,1),num:o.down,"onUpdate:num":p=>o.down=p,active:o.isDown,"onUpdate:active":p=>o.isDown=p,icon:"down-active"},null,8,["onClick","num","onUpdate:num","active","onUpdate:active"]),c(u,{onClick:p=>E(o.id,0),num:o.up,"onUpdate:num":p=>o.up=p,active:o.isUp,"onUpdate:active":p=>o.isUp=p,icon:"up-active"},null,8,["onClick","num","onUpdate:num","active","onUpdate:active"])])]),$(l("div",Ge,[$(l("textarea",{class:"content","onUpdate:modelValue":n[3]||(n[3]=p=>z(f)?f.value=p:f=p),placeholder:"\u8BF4\u8BF4\u4F60\u7684\u770B\u6CD5"},null,512),[[T,t(f)]]),c(C,{class:"btn",onClick:p=>b(e.id,o.sender.id,t(f))},{default:_(()=>[m("\u56DE\u590D")]),_:2},1032,["onClick"])],512),[[X,o.isShow]])])])}),256)),e.total>((G=e.children)==null?void 0:G.length)?(h(),x(u,{key:0,class:"collapse",icon:"arrow-down",onClick:o=>Z(e)},{default:_(()=>[m("\u5C55\u5F00"+r(e.total-e.children.length)+"\u6761\u56DE\u590D",1)]),_:2},1032,["onClick"])):w("",!0)])):w("",!0)])])}),128))])]),l("div",Je,[l("div",Oe,[c(S,{to:`/user/${t(a).authorInfo.id}`,class:"face"},{default:_(()=>[c(k,{src:`/api${t(a).authorInfo.avatar}`},null,8,["src"]),l("span",null,r(t(a).authorInfo.nickname),1)]),_:1},8,["to"]),l("nav",Qe,[c(S,{to:`/user/${t(a).authorInfo.id}`},{default:_(()=>[l("span",null,r(t(a).authorInfo.passCount),1),Ke]),_:1},8,["to"]),c(S,{to:`/user/${t(a).authorInfo.id}/up`},{default:_(()=>[l("span",null,r(t(a).authorInfo.up),1),We]),_:1},8,["to"]),c(S,{to:`/user/${t(a).authorInfo.id}/down`},{default:_(()=>[l("span",null,r(t(a).authorInfo.down),1),Xe]),_:1},8,["to"])])]),l("div",Ye,[c(u,{onClick:n[4]||(n[4]=e=>F(t(a).id,0)),num:t(a).up,"onUpdate:num":n[5]||(n[5]=e=>t(a).up=e),active:t(a).isUp,"onUpdate:active":n[6]||(n[6]=e=>t(a).isUp=e),icon:"up-active"},null,8,["num","active"]),c(u,{onClick:n[7]||(n[7]=e=>F(t(a).id,1)),num:t(a).down,"onUpdate:num":n[8]||(n[8]=e=>t(a).down=e),active:t(a).isDown,"onUpdate:active":n[9]||(n[9]=e=>t(a).isDown=e),icon:"down-active"},null,8,["num","active"]),c(u,{onClick:n[10]||(n[10]=e=>F(t(a).id,2)),num:t(a).star,"onUpdate:num":n[11]||(n[11]=e=>t(a).star=e),active:t(a).isStar,"onUpdate:active":n[12]||(n[12]=e=>t(a).isStar=e),icon:"star-active"},null,8,["num","active"]),c(u,{icon:"view"},{default:_(()=>[m(r(t(pe).formatNum(t(a).view)),1)]),_:1})])])])):w("",!0)}}});const on=fe(Ze,[["__scopeId","data-v-7102557e"]]);export{on as default};
