import{d as ee,s as ne,r as T,G as K,o as te,b as oe,O as se,j as l,c as h,e as C,f as t,g as i,w as _,h as $,v as z,P as V,t as r,F as O,H as Q,k as g,u as le,Q as ae,K as ce,R as b,q as W,S as ie,_ as ue,T as de,x as re,z as f,l as x,U as X,J as pe,V as _e,W as ve,A as he,B as fe,C as me}from"./index.ff74c8d4.js";import{C as ke}from"./index.6a006d6b.js";const L=y=>(he("data-v-47ef1bbe"),y=y(),fe(),y),we={key:0,class:"container"},Ce={class:"content"},ge={class:"blog"},De={class:"ip"},Ue={class:"comments"},Se={class:"header"},$e={class:"area"},ye={class:"all-comment"},Be={class:"detail"},Ee={class:"top"},xe={class:"nickname"},Ie={class:"time"},Fe={class:"center"},Ne={class:"bottom"},Te={class:"icons"},ze={class:"area"},Ve={key:0,class:"children"},be={class:"comment"},Le={class:"detail"},Ae={class:"top"},Re={class:"nickname"},He={key:1,class:"nickname"},Me={class:"time"},Pe={class:"center"},je={class:"bottom"},qe={class:"icons"},Ge={class:"area"},Je={class:"sidebar"},Ke={class:"author-info"},Oe={class:"account"},Qe=L(()=>t("span",null,"\u53D1\u5E03",-1)),We=L(()=>t("span",null,"\u9876\u8FC7",-1)),Xe=L(()=>t("span",null,"\u8E29\u8FC7",-1)),Ye={class:"icon-bar"},Ze=ee({__name:"index",setup(y){const Y=le(),I=ne().userInfo,U=Y.params.blogId;let a=T(null),v=K([]),S=T(""),m=T("");const D=K({pageNum:1,pageSize:10,total:"0"}),Z=e=>{b({blogId:U,parent:e.id,pageNum:++e.pageNum,pageSize:3}).then(s=>{s.list.forEach(c=>{c.show=!1}),e.children.push(...s.list),e.total=s.total})},A=e=>{let s=!0;e.isShow&&(s=!1),v.forEach(c=>{var d;c.isShow=!1,(d=c.children)==null||d.forEach(u=>{u.isShow=!1})}),s&&(e.isShow=!0)},F=(e,s,c)=>{ae({blogId:U,parent:e,receiveId:s,content:c}).then(d=>{if(d.children=[],console.log(d),e){for(const u of v)if(u.id==e){u.children.push(d);break}}else v.unshift(d);v.forEach(u=>{var k;u.isShow=!1,(k=u.children)==null||k.forEach(w=>{w.isShow=!1})})})},R=e=>{ke(`\u786E\u8BA4\u5220\u9664\u8BC4\u8BBA\u201C${e.content}\u201D\u5417?`,()=>{_e(e.id).then(s=>{console.log(s);e:for(let c=0;c<v.length;c++){if(v[c].id==e.id){v.splice(c,1);break e}for(let d=0;d<v[c].children.length;d++)if(v[c].children[d].id==e.id){v[c].children.splice(d,1);break e}}})})},N=(e,s)=>{ce(e.id,s).then(c=>{s==0?(e.isUp?e.up--:e.up++,e.isUp=!e.isUp):s==1?(e.isDown?e.down--:e.down++,e.isDown=!e.isDown):s==2&&(e.isStar?e.star--:e.star++,e.isStar=!e.isStar)})},B=(e,s)=>{ve(e,s).then(c=>{console.log(c)})},H=()=>{const e=document.documentElement;e.scrollHeight-e.scrollTop-e.clientHeight<1&&D.pageNum*D.pageSize<parseInt(D.total)&&(D.pageNum++,M())};te(()=>{window.addEventListener("scroll",H)}),oe(()=>{window.removeEventListener("scroll",H)});const M=()=>{b({blogId:U,...D}).then(e=>{D.total=e.total,e.list.forEach(c=>{c.isShow=!1});const s=[];e.list.forEach(c=>{s.push(b({blogId:U,parent:c.id,pageSize:3}))}),Promise.all(s).then(c=>{console.log(c),c.forEach((d,u)=>{d.list.forEach(k=>{k.isShow=!1}),e.list[u].children=d.list,e.list[u].total=d.total,e.list[u].pageNum=1}),v.push(...e.list),console.log(v)})})};return se(U).then(e=>{a.value=e,a.value.content=`# ${e.title}
## ${e.description}
${e.content}`}),M(),(e,s)=>{var P;const c=W("v-md-preview"),d=ie,u=ue,k=de,w=re,E=W("router-link");return l(a)?(h(),C("main",we,[t("div",Ce,[t("div",ge,[i(c,{text:l(a).content},null,8,["text"]),t("div",De,[i(d,null,{default:_(()=>[f(r(l(a).ipTerritory),1)]),_:1}),i(u,{icon:"history",type:"text"},{default:_(()=>[f(r(l(a).createTime),1)]),_:1})])]),t("div",Ue,[t("div",Se,[t("div",null,[i(k,{src:`/api${(P=l(I))==null?void 0:P.avatar}`},null,8,["src"])]),t("div",$e,[$(t("textarea",{class:"content","onUpdate:modelValue":s[0]||(s[0]=o=>V(S)?S.value=o:S=o),placeholder:"\u8BF4\u8BF4\u4F60\u7684\u770B\u6CD5"},null,512),[[z,l(S)]]),i(w,{class:"btn",onClick:s[1]||(s[1]=o=>F(void 0,void 0,l(S)))},{default:_(()=>[f("\u53D1\u5E03")]),_:1})])]),t("div",ye,"\u5168\u90E8\u8BC4\u8BBA\uFF1A"+r(l(a).comment)+"\u6761",1),(h(!0),C(O,null,Q(l(v),o=>{var j,q,G;return h(),C("div",{class:"comment",key:o.id},[i(k,{src:`/api${o.sender.avatar}`},null,8,["src"]),t("div",Be,[t("div",Ee,[t("div",xe,r(o.sender.nickname),1),t("div",Ie,r(o.createTime),1)]),t("p",Fe,r(o.content),1),t("div",Ne,[i(d,{size:"small"},{default:_(()=>[f(r(o.ipTerritory),1)]),_:2},1024),i(w,{type:"text",onClick:n=>A(o),style:{"margin-left":"15px"}},{default:_(()=>[f(r(o.isShow?"\u6536\u8D77":"\u56DE\u590D"),1)]),_:2},1032,["onClick"]),t("div",Te,[o.sender.id==((j=l(I))==null?void 0:j.id)?(h(),x(u,{key:0,onClick:n=>R(o),icon:"delete"},null,8,["onClick"])):g("",!0),i(u,{onClick:n=>B(o.id,1),num:o.down,"onUpdate:num":n=>o.down=n,active:o.isDown,"onUpdate:active":n=>o.isDown=n,icon:"down-active"},null,8,["onClick","num","onUpdate:num","active","onUpdate:active"]),i(u,{onClick:n=>B(o.id,0),num:o.up,"onUpdate:num":n=>o.up=n,active:o.isUp,"onUpdate:active":n=>o.isUp=n,icon:"up-active"},null,8,["onClick","num","onUpdate:num","active","onUpdate:active"])])]),$(t("div",ze,[$(t("textarea",{class:"content","onUpdate:modelValue":s[2]||(s[2]=n=>V(m)?m.value=n:m=n),placeholder:"\u8BF4\u8BF4\u4F60\u7684\u770B\u6CD5"},null,512),[[z,l(m)]]),i(w,{class:"btn",onClick:n=>F(o.id,void 0,l(m))},{default:_(()=>[f("\u56DE\u590D")]),_:2},1032,["onClick"])],512),[[X,o.isShow]]),((q=o.children)==null?void 0:q.length)!=0?(h(),C("div",Ve,[(h(!0),C(O,null,Q(o.children,n=>{var J;return h(),C("div",be,[i(k,{src:`/api${n.sender.avatar}`,size:"40px"},null,8,["src"]),t("div",Le,[t("div",Ae,[t("div",Re,r(n.sender.nickname),1),n.receiver?(h(),x(u,{key:0,class:"arrow",icon:"arrow-right",type:"text"})):g("",!0),n.receiver?(h(),C("div",He,r(n.receiver.nickname),1)):g("",!0),t("div",Me,r(n.createTime),1)]),t("p",Pe,r(n.content),1),t("div",je,[i(d,{size:"small"},{default:_(()=>[f(r(n.ipTerritory),1)]),_:2},1024),i(w,{type:"text",onClick:p=>A(n),style:{"margin-left":"15px"}},{default:_(()=>[f(r(n.isShow?"\u6536\u8D77":"\u56DE\u590D"),1)]),_:2},1032,["onClick"]),t("div",qe,[n.sender.id==((J=l(I))==null?void 0:J.id)?(h(),x(u,{key:0,onClick:p=>R(n),icon:"delete"},null,8,["onClick"])):g("",!0),i(u,{onClick:p=>B(n.id,1),num:n.down,"onUpdate:num":p=>n.down=p,active:n.isDown,"onUpdate:active":p=>n.isDown=p,icon:"down-active"},null,8,["onClick","num","onUpdate:num","active","onUpdate:active"]),i(u,{onClick:p=>B(n.id,0),num:n.up,"onUpdate:num":p=>n.up=p,active:n.isUp,"onUpdate:active":p=>n.isUp=p,icon:"up-active"},null,8,["onClick","num","onUpdate:num","active","onUpdate:active"])])]),$(t("div",Ge,[$(t("textarea",{class:"content","onUpdate:modelValue":s[3]||(s[3]=p=>V(m)?m.value=p:m=p),placeholder:"\u8BF4\u8BF4\u4F60\u7684\u770B\u6CD5"},null,512),[[z,l(m)]]),i(w,{class:"btn",onClick:p=>F(o.id,n.sender.id,l(m))},{default:_(()=>[f("\u56DE\u590D")]),_:2},1032,["onClick"])],512),[[X,n.isShow]])])])}),256)),o.total>((G=o.children)==null?void 0:G.length)?(h(),x(u,{key:0,class:"collapse",icon:"arrow-down",onClick:n=>Z(o)},{default:_(()=>[f("\u5C55\u5F00"+r(o.total-o.children.length)+"\u6761\u56DE\u590D",1)]),_:2},1032,["onClick"])):g("",!0)])):g("",!0)])])}),128))])]),t("div",Je,[t("div",Ke,[i(E,{to:`/user/${l(a).authorInfo.id}`,class:"face"},{default:_(()=>[i(k,{src:`/api${l(a).authorInfo.avatar}`},null,8,["src"]),t("span",null,r(l(a).authorInfo.nickname),1)]),_:1},8,["to"]),t("nav",Oe,[i(E,{to:`/user/${l(a).authorInfo.id}`},{default:_(()=>[t("span",null,r(l(a).authorInfo.passCount),1),Qe]),_:1},8,["to"]),i(E,{to:`/user/${l(a).authorInfo.id}/up`},{default:_(()=>[t("span",null,r(l(a).authorInfo.up),1),We]),_:1},8,["to"]),i(E,{to:`/user/${l(a).authorInfo.id}/down`},{default:_(()=>[t("span",null,r(l(a).authorInfo.down),1),Xe]),_:1},8,["to"])])]),t("div",Ye,[i(u,{onClick:s[4]||(s[4]=o=>N(l(a),0)),num:l(a).up,active:l(a).isUp,icon:"up-active"},null,8,["num","active"]),i(u,{onClick:s[5]||(s[5]=o=>N(l(a),1)),num:l(a).down,active:l(a).isDown,icon:"down-active"},null,8,["num","active"]),i(u,{onClick:s[6]||(s[6]=o=>N(l(a),2)),num:l(a).star,active:l(a).isStar,icon:"star-active"},null,8,["num","active"]),i(u,{icon:"view"},{default:_(()=>[f(r(l(pe).formatNum(l(a).view)),1)]),_:1})])])])):g("",!0)}}});const tn=me(Ze,[["__scopeId","data-v-47ef1bbe"]]);export{tn as default};
