import{d as ne,s as te,r as N,H as W,o as oe,b as se,Q as le,j as t,c as v,e as g,f as n,g as c,w as p,h as B,v as T,R as V,t as r,F as X,I as Y,k as w,u as ae,S as ce,M as ie,N as G,T as z,x as J,U as ue,_ as de,V as re,y as _e,A as f,l as x,W as O,K as pe,X as he,Y as ve,B as fe,C as me,D as ke}from"./index.e102da7f.js";import{C as Ce}from"./index.fbcbd5a4.js";const L=E=>(fe("data-v-e71dcbba"),E=E(),me(),E),ge={key:0,class:"container"},we={class:"content"},De={class:"blog"},$e={class:"ip"},ye={class:"comments"},Be={class:"header"},Ee={class:"area"},Se={class:"all-comment"},be={class:"detail"},xe={class:"top"},Ie={class:"nickname"},Ue={class:"time"},Fe={class:"center"},Ne={class:"bottom"},Te={class:"icons"},Ve={class:"area"},ze={key:0,class:"children"},Le={class:"comment"},Ae={class:"detail"},Me={class:"top"},Re={class:"nickname"},He={key:1,class:"nickname"},je={class:"time"},Pe={class:"center"},qe={class:"bottom"},Ke={class:"icons"},Qe={class:"area"},We={class:"sidebar"},Xe={class:"author-info"},Ye={class:"account"},Ge=L(()=>n("span",null,"\u53D1\u5E03",-1)),Je=L(()=>n("span",null,"\u9876\u8FC7",-1)),Oe=L(()=>n("span",null,"\u8E29\u8FC7",-1)),Ze={class:"icon-bar"},en=ne({__name:"index",setup(E){const Z=ae(),I=te().userInfo,$=Z.params.blogId;let a=N(null),h=W([]),y=N(""),m=N("");const D=W({pageNum:1,pageSize:10,total:"0"}),ee=e=>{z({blogId:$,parent:e.id,pageNum:++e.pageNum,pageSize:3}).then(o=>{o.list.forEach(i=>{i.show=!1}),e.children.push(...o.list),e.total=o.total})},A=e=>{let o=!0;e.isShow&&(o=!1),h.forEach(i=>{var d;i.isShow=!1,(d=i.children)==null||d.forEach(u=>{u.isShow=!1})}),o&&(e.isShow=!0)},U=(e,o,i)=>{ce({blogId:$,parent:e,receiveId:o,content:i}).then(d=>{if(d.children=[],console.log(d),e){for(const u of h)if(u.id==e){u.children.push(d);break}}else h.unshift(d);h.forEach(u=>{var k;u.isShow=!1,(k=u.children)==null||k.forEach(C=>{C.isShow=!1})})})},M=e=>{Ce(`\u786E\u8BA4\u5220\u9664\u8BC4\u8BBA\u201C${e.content}\u201D\u5417?`,()=>{he(e.id).then(o=>{console.log(o);e:for(let i=0;i<h.length;i++){if(h[i].id==e.id){h.splice(i,1);break e}for(let d=0;d<h[i].children.length;d++)if(h[i].children[d].id==e.id){h[i].children.splice(d,1);break e}}})})},F=(e,o)=>{ie(e.id,o).then(i=>{G(e,o)})},S=(e,o)=>{ve(e.id,o).then(i=>{G(e,o)})},R=()=>{const e=document.documentElement;e.scrollHeight-e.scrollTop-e.clientHeight<1&&D.pageNum*D.pageSize<parseInt(D.total)&&(D.pageNum++,H())};oe(()=>{window.addEventListener("scroll",R)}),se(()=>{window.removeEventListener("scroll",R)});const H=()=>{z({blogId:$,...D}).then(e=>{D.total=e.total,e.list.forEach(i=>{i.isShow=!1});const o=[];e.list.forEach(i=>{o.push(z({blogId:$,parent:i.id,pageSize:3}))}),Promise.all(o).then(i=>{console.log(i),i.forEach((d,u)=>{d.list.forEach(k=>{k.isShow=!1}),e.list[u].children=d.list,e.list[u].total=d.total,e.list[u].pageNum=1}),h.push(...e.list)})})};return le($).then(e=>{a.value=e,a.value.content=`# ${e.title}
## ${e.description}
${e.content}`}),H(),(e,o)=>{var j;const i=J("v-md-preview"),d=ue,u=de,k=re,C=_e,b=J("router-link");return t(a)?(v(),g("main",ge,[n("div",we,[n("div",De,[c(i,{text:t(a).content},null,8,["text"]),n("div",$e,[c(d,null,{default:p(()=>[f(r(t(a).ipTerritory),1)]),_:1}),c(u,{icon:"history",type:"text"},{default:p(()=>[f(r(t(a).createTime),1)]),_:1})])]),n("div",ye,[n("div",Be,[n("div",null,[c(k,{src:`/api${(j=t(I))==null?void 0:j.avatar}`},null,8,["src"])]),n("div",Ee,[B(n("textarea",{class:"content","onUpdate:modelValue":o[0]||(o[0]=s=>V(y)?y.value=s:y=s),placeholder:"\u8BF4\u8BF4\u4F60\u7684\u770B\u6CD5"},null,512),[[T,t(y)]]),c(C,{class:"btn",onClick:o[1]||(o[1]=s=>U(void 0,void 0,t(y)))},{default:p(()=>[f("\u53D1\u5E03")]),_:1})])]),n("div",Se,"\u5168\u90E8\u8BC4\u8BBA\uFF1A"+r(t(a).comment)+"\u6761",1),(v(!0),g(X,null,Y(t(h),s=>{var P,q,K;return v(),g("div",{class:"comment",key:s.id},[c(k,{src:`/api${s.sender.avatar}`},null,8,["src"]),n("div",be,[n("div",xe,[n("div",Ie,r(s.sender.nickname),1),n("div",Ue,r(s.createTime),1)]),n("p",Fe,r(s.content),1),n("div",Ne,[c(d,{size:"small"},{default:p(()=>[f(r(s.ipTerritory),1)]),_:2},1024),c(C,{type:"text",onClick:l=>A(s),style:{"margin-left":"15px"}},{default:p(()=>[f(r(s.isShow?"\u6536\u8D77":"\u56DE\u590D"),1)]),_:2},1032,["onClick"]),n("div",Te,[s.sender.id==((P=t(I))==null?void 0:P.id)?(v(),x(u,{key:0,onClick:l=>M(s),icon:"delete"},null,8,["onClick"])):w("",!0),c(u,{onClick:l=>S(s,1),num:s.down,active:s.isDown,icon:"down-active"},null,8,["onClick","num","active"]),c(u,{onClick:l=>S(s,0),num:s.up,active:s.isUp,icon:"up-active"},null,8,["onClick","num","active"])])]),B(n("div",Ve,[B(n("textarea",{class:"content","onUpdate:modelValue":o[2]||(o[2]=l=>V(m)?m.value=l:m=l),placeholder:"\u8BF4\u8BF4\u4F60\u7684\u770B\u6CD5"},null,512),[[T,t(m)]]),c(C,{class:"btn",onClick:l=>U(s.id,void 0,t(m))},{default:p(()=>[f("\u56DE\u590D")]),_:2},1032,["onClick"])],512),[[O,s.isShow]]),((q=s.children)==null?void 0:q.length)!=0?(v(),g("div",ze,[(v(!0),g(X,null,Y(s.children,l=>{var Q;return v(),g("div",Le,[c(k,{src:`/api${l.sender.avatar}`,size:"40px"},null,8,["src"]),n("div",Ae,[n("div",Me,[n("div",Re,r(l.sender.nickname),1),l.receiver?(v(),x(u,{key:0,class:"arrow",icon:"arrow-right",type:"text"})):w("",!0),l.receiver?(v(),g("div",He,r(l.receiver.nickname),1)):w("",!0),n("div",je,r(l.createTime),1)]),n("p",Pe,r(l.content),1),n("div",qe,[c(d,{size:"small"},{default:p(()=>[f(r(l.ipTerritory),1)]),_:2},1024),c(C,{type:"text",onClick:_=>A(l),style:{"margin-left":"15px"}},{default:p(()=>[f(r(l.isShow?"\u6536\u8D77":"\u56DE\u590D"),1)]),_:2},1032,["onClick"]),n("div",Ke,[l.sender.id==((Q=t(I))==null?void 0:Q.id)?(v(),x(u,{key:0,onClick:_=>M(l),icon:"delete"},null,8,["onClick"])):w("",!0),c(u,{onClick:_=>S(l.id,1),num:l.down,"onUpdate:num":_=>l.down=_,active:l.isDown,"onUpdate:active":_=>l.isDown=_,icon:"down-active"},null,8,["onClick","num","onUpdate:num","active","onUpdate:active"]),c(u,{onClick:_=>S(l.id,0),num:l.up,"onUpdate:num":_=>l.up=_,active:l.isUp,"onUpdate:active":_=>l.isUp=_,icon:"up-active"},null,8,["onClick","num","onUpdate:num","active","onUpdate:active"])])]),B(n("div",Qe,[B(n("textarea",{class:"content","onUpdate:modelValue":o[3]||(o[3]=_=>V(m)?m.value=_:m=_),placeholder:"\u8BF4\u8BF4\u4F60\u7684\u770B\u6CD5"},null,512),[[T,t(m)]]),c(C,{class:"btn",onClick:_=>U(s.id,l.sender.id,t(m))},{default:p(()=>[f("\u56DE\u590D")]),_:2},1032,["onClick"])],512),[[O,l.isShow]])])])}),256)),s.total>((K=s.children)==null?void 0:K.length)?(v(),x(u,{key:0,class:"collapse",icon:"arrow-down",onClick:l=>ee(s)},{default:p(()=>[f("\u5C55\u5F00"+r(s.total-s.children.length)+"\u6761\u56DE\u590D",1)]),_:2},1032,["onClick"])):w("",!0)])):w("",!0)])])}),128))])]),n("div",We,[n("div",Xe,[c(b,{to:`/user/${t(a).authorInfo.id}`,class:"face"},{default:p(()=>[c(k,{src:`/api${t(a).authorInfo.avatar}`},null,8,["src"]),n("span",null,r(t(a).authorInfo.nickname),1)]),_:1},8,["to"]),n("nav",Ye,[c(b,{to:`/user/${t(a).authorInfo.id}`},{default:p(()=>[n("span",null,r(t(a).authorInfo.passCount),1),Ge]),_:1},8,["to"]),c(b,{to:`/user/${t(a).authorInfo.id}/up`},{default:p(()=>[n("span",null,r(t(a).authorInfo.up),1),Je]),_:1},8,["to"]),c(b,{to:`/user/${t(a).authorInfo.id}/down`},{default:p(()=>[n("span",null,r(t(a).authorInfo.down),1),Oe]),_:1},8,["to"])])]),n("div",Ze,[c(u,{onClick:o[4]||(o[4]=s=>F(t(a),0)),num:t(a).up,active:t(a).isUp,icon:"up-active"},null,8,["num","active"]),c(u,{onClick:o[5]||(o[5]=s=>F(t(a),1)),num:t(a).down,active:t(a).isDown,icon:"down-active"},null,8,["num","active"]),c(u,{onClick:o[6]||(o[6]=s=>F(t(a),2)),num:t(a).star,active:t(a).isStar,icon:"star-active"},null,8,["num","active"]),c(u,{icon:"view"},{default:p(()=>[f(r(t(pe).formatNum(t(a).view)),1)]),_:1})])])])):w("",!0)}}});const on=ke(en,[["__scopeId","data-v-e71dcbba"]]);export{on as default};
