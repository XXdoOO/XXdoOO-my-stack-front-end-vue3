import{d as ne,s as te,r as N,G as K,o as oe,b as se,P as le,j as t,c as v,e as g,f as n,g as c,w as p,h as B,v as T,Q as z,t as r,F as Q,H as W,k as w,u as ae,R as ce,K as ie,M as X,S as V,q as O,T as ue,_ as de,U as re,x as _e,z as f,l as x,V as Y,J as pe,W as he,X as ve,A as fe,B as me,C as ke}from"./index.aa1ca29a.js";import{C as Ce}from"./index.9ec9dccb.js";const L=E=>(fe("data-v-e71dcbba"),E=E(),me(),E),ge={key:0,class:"container"},we={class:"content"},$e={class:"blog"},De={class:"ip"},ye={class:"comments"},Be={class:"header"},Ee={class:"area"},Se={class:"all-comment"},be={class:"detail"},xe={class:"top"},Ie={class:"nickname"},Ue={class:"time"},Fe={class:"center"},Ne={class:"bottom"},Te={class:"icons"},ze={class:"area"},Ve={key:0,class:"children"},Le={class:"comment"},Ae={class:"detail"},Me={class:"top"},Re={class:"nickname"},He={key:1,class:"nickname"},Pe={class:"time"},je={class:"center"},qe={class:"bottom"},Ge={class:"icons"},Je={class:"area"},Ke={class:"sidebar"},Qe={class:"author-info"},We={class:"account"},Xe=L(()=>n("span",null,"\u53D1\u5E03",-1)),Oe=L(()=>n("span",null,"\u9876\u8FC7",-1)),Ye=L(()=>n("span",null,"\u8E29\u8FC7",-1)),Ze={class:"icon-bar"},en=ne({__name:"index",setup(E){const Z=ae(),I=te().userInfo,D=Z.params.blogId;let a=N(null),h=K([]),y=N(""),m=N("");const $=K({pageNum:1,pageSize:10,total:"0"}),ee=e=>{V({blogId:D,parent:e.id,pageNum:++e.pageNum,pageSize:3}).then(o=>{o.list.forEach(i=>{i.show=!1}),e.children.push(...o.list),e.total=o.total})},A=e=>{let o=!0;e.isShow&&(o=!1),h.forEach(i=>{var d;i.isShow=!1,(d=i.children)==null||d.forEach(u=>{u.isShow=!1})}),o&&(e.isShow=!0)},U=(e,o,i)=>{ce({blogId:D,parent:e,receiveId:o,content:i}).then(d=>{if(d.children=[],console.log(d),e){for(const u of h)if(u.id==e){u.children.push(d);break}}else h.unshift(d);h.forEach(u=>{var k;u.isShow=!1,(k=u.children)==null||k.forEach(C=>{C.isShow=!1})})})},M=e=>{Ce(`\u786E\u8BA4\u5220\u9664\u8BC4\u8BBA\u201C${e.content}\u201D\u5417?`,()=>{he(e.id).then(o=>{console.log(o);e:for(let i=0;i<h.length;i++){if(h[i].id==e.id){h.splice(i,1);break e}for(let d=0;d<h[i].children.length;d++)if(h[i].children[d].id==e.id){h[i].children.splice(d,1);break e}}})})},F=(e,o)=>{ie(e.id,o).then(i=>{X(e,o)})},S=(e,o)=>{ve(e.id,o).then(i=>{X(e,o)})},R=()=>{const e=document.documentElement;e.scrollHeight-e.scrollTop-e.clientHeight<1&&$.pageNum*$.pageSize<parseInt($.total)&&($.pageNum++,H())};oe(()=>{window.addEventListener("scroll",R)}),se(()=>{window.removeEventListener("scroll",R)});const H=()=>{V({blogId:D,...$}).then(e=>{$.total=e.total,e.list.forEach(i=>{i.isShow=!1});const o=[];e.list.forEach(i=>{o.push(V({blogId:D,parent:i.id,pageSize:3}))}),Promise.all(o).then(i=>{console.log(i),i.forEach((d,u)=>{d.list.forEach(k=>{k.isShow=!1}),e.list[u].children=d.list,e.list[u].total=d.total,e.list[u].pageNum=1}),h.push(...e.list)})})};return le(D).then(e=>{a.value=e,a.value.content=`# ${e.title}
## ${e.description}
${e.content}`}),H(),(e,o)=>{var P;const i=O("v-md-preview"),d=ue,u=de,k=re,C=_e,b=O("router-link");return t(a)?(v(),g("main",ge,[n("div",we,[n("div",$e,[c(i,{text:t(a).content},null,8,["text"]),n("div",De,[c(d,null,{default:p(()=>[f(r(t(a).ipTerritory),1)]),_:1}),c(u,{icon:"history",type:"text"},{default:p(()=>[f(r(t(a).createTime),1)]),_:1})])]),n("div",ye,[n("div",Be,[n("div",null,[c(k,{src:`/api${(P=t(I))==null?void 0:P.avatar}`},null,8,["src"])]),n("div",Ee,[B(n("textarea",{class:"content","onUpdate:modelValue":o[0]||(o[0]=s=>z(y)?y.value=s:y=s),placeholder:"\u8BF4\u8BF4\u4F60\u7684\u770B\u6CD5"},null,512),[[T,t(y)]]),c(C,{class:"btn",onClick:o[1]||(o[1]=s=>U(void 0,void 0,t(y)))},{default:p(()=>[f("\u53D1\u5E03")]),_:1})])]),n("div",Se,"\u5168\u90E8\u8BC4\u8BBA\uFF1A"+r(t(a).comment)+"\u6761",1),(v(!0),g(Q,null,W(t(h),s=>{var j,q,G;return v(),g("div",{class:"comment",key:s.id},[c(k,{src:`/api${s.sender.avatar}`},null,8,["src"]),n("div",be,[n("div",xe,[n("div",Ie,r(s.sender.nickname),1),n("div",Ue,r(s.createTime),1)]),n("p",Fe,r(s.content),1),n("div",Ne,[c(d,{size:"small"},{default:p(()=>[f(r(s.ipTerritory),1)]),_:2},1024),c(C,{type:"text",onClick:l=>A(s),style:{"margin-left":"15px"}},{default:p(()=>[f(r(s.isShow?"\u6536\u8D77":"\u56DE\u590D"),1)]),_:2},1032,["onClick"]),n("div",Te,[s.sender.id==((j=t(I))==null?void 0:j.id)?(v(),x(u,{key:0,onClick:l=>M(s),icon:"delete"},null,8,["onClick"])):w("",!0),c(u,{onClick:l=>S(s,1),num:s.down,active:s.isDown,icon:"down-active"},null,8,["onClick","num","active"]),c(u,{onClick:l=>S(s,0),num:s.up,active:s.isUp,icon:"up-active"},null,8,["onClick","num","active"])])]),B(n("div",ze,[B(n("textarea",{class:"content","onUpdate:modelValue":o[2]||(o[2]=l=>z(m)?m.value=l:m=l),placeholder:"\u8BF4\u8BF4\u4F60\u7684\u770B\u6CD5"},null,512),[[T,t(m)]]),c(C,{class:"btn",onClick:l=>U(s.id,void 0,t(m))},{default:p(()=>[f("\u56DE\u590D")]),_:2},1032,["onClick"])],512),[[Y,s.isShow]]),((q=s.children)==null?void 0:q.length)!=0?(v(),g("div",Ve,[(v(!0),g(Q,null,W(s.children,l=>{var J;return v(),g("div",Le,[c(k,{src:`/api${l.sender.avatar}`,size:"40px"},null,8,["src"]),n("div",Ae,[n("div",Me,[n("div",Re,r(l.sender.nickname),1),l.receiver?(v(),x(u,{key:0,class:"arrow",icon:"arrow-right",type:"text"})):w("",!0),l.receiver?(v(),g("div",He,r(l.receiver.nickname),1)):w("",!0),n("div",Pe,r(l.createTime),1)]),n("p",je,r(l.content),1),n("div",qe,[c(d,{size:"small"},{default:p(()=>[f(r(l.ipTerritory),1)]),_:2},1024),c(C,{type:"text",onClick:_=>A(l),style:{"margin-left":"15px"}},{default:p(()=>[f(r(l.isShow?"\u6536\u8D77":"\u56DE\u590D"),1)]),_:2},1032,["onClick"]),n("div",Ge,[l.sender.id==((J=t(I))==null?void 0:J.id)?(v(),x(u,{key:0,onClick:_=>M(l),icon:"delete"},null,8,["onClick"])):w("",!0),c(u,{onClick:_=>S(l.id,1),num:l.down,"onUpdate:num":_=>l.down=_,active:l.isDown,"onUpdate:active":_=>l.isDown=_,icon:"down-active"},null,8,["onClick","num","onUpdate:num","active","onUpdate:active"]),c(u,{onClick:_=>S(l.id,0),num:l.up,"onUpdate:num":_=>l.up=_,active:l.isUp,"onUpdate:active":_=>l.isUp=_,icon:"up-active"},null,8,["onClick","num","onUpdate:num","active","onUpdate:active"])])]),B(n("div",Je,[B(n("textarea",{class:"content","onUpdate:modelValue":o[3]||(o[3]=_=>z(m)?m.value=_:m=_),placeholder:"\u8BF4\u8BF4\u4F60\u7684\u770B\u6CD5"},null,512),[[T,t(m)]]),c(C,{class:"btn",onClick:_=>U(s.id,l.sender.id,t(m))},{default:p(()=>[f("\u56DE\u590D")]),_:2},1032,["onClick"])],512),[[Y,l.isShow]])])])}),256)),s.total>((G=s.children)==null?void 0:G.length)?(v(),x(u,{key:0,class:"collapse",icon:"arrow-down",onClick:l=>ee(s)},{default:p(()=>[f("\u5C55\u5F00"+r(s.total-s.children.length)+"\u6761\u56DE\u590D",1)]),_:2},1032,["onClick"])):w("",!0)])):w("",!0)])])}),128))])]),n("div",Ke,[n("div",Qe,[c(b,{to:`/user/${t(a).authorInfo.id}`,class:"face"},{default:p(()=>[c(k,{src:`/api${t(a).authorInfo.avatar}`},null,8,["src"]),n("span",null,r(t(a).authorInfo.nickname),1)]),_:1},8,["to"]),n("nav",We,[c(b,{to:`/user/${t(a).authorInfo.id}`},{default:p(()=>[n("span",null,r(t(a).authorInfo.passCount),1),Xe]),_:1},8,["to"]),c(b,{to:`/user/${t(a).authorInfo.id}/up`},{default:p(()=>[n("span",null,r(t(a).authorInfo.up),1),Oe]),_:1},8,["to"]),c(b,{to:`/user/${t(a).authorInfo.id}/down`},{default:p(()=>[n("span",null,r(t(a).authorInfo.down),1),Ye]),_:1},8,["to"])])]),n("div",Ze,[c(u,{onClick:o[4]||(o[4]=s=>F(t(a),0)),num:t(a).up,active:t(a).isUp,icon:"up-active"},null,8,["num","active"]),c(u,{onClick:o[5]||(o[5]=s=>F(t(a),1)),num:t(a).down,active:t(a).isDown,icon:"down-active"},null,8,["num","active"]),c(u,{onClick:o[6]||(o[6]=s=>F(t(a),2)),num:t(a).star,active:t(a).isStar,icon:"star-active"},null,8,["num","active"]),c(u,{icon:"view"},{default:p(()=>[f(r(t(pe).formatNum(t(a).view)),1)]),_:1})])])])):w("",!0)}}});const on=ke(en,[["__scopeId","data-v-e71dcbba"]]);export{on as default};
